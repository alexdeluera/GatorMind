# GatorMind — FastAPI Backend

This FastAPI service exposes precomputed cluster-path data stored in `activation_cache/` so the React dashboard can fetch and visualize it.

This backend/API:

- Does **not** run models
- Does **not** extract activations
- Does **not** perform clustering

It only reads existing artifacts generated by the activation pipeline.

---

# Purpose

The API provides:

- Available models
- Available cluster-path sets
- Model metadata (layers, cluster count, example count)
- Cluster centroids per layer
- Cluster paths per example
- Paginated previews for large datasets

These endpoints are consumed directly by the frontend dashboard.

---

# Environment Setup

This environment is used for:

- Serving JSON cluster artifacts
- Enabling frontend -> backend communication
- Providing interactive API documentation

---

## 1. Install Required Packages

```bash
pip install fastapi "uvicorn[standard]" numpy
```

---

## 2. Ensure Activation Cache Exists

The backend requires precomputed data inside:

```
activation_cache/
```

Example structure:

```
activation_cache/
    CelebA/
        metadata.json
        labels.npy
        image_ids.npy
        set_01/
            centroids.json
            paths.json
```

If this directory is missing or empty, endpoints will return empty results.

---

# Running the API Server

From the project root:

```bash
uvicorn backend.app.main:app --reload
```

The server runs at:

Base URL for all API requests:

```
http://127.0.0.1:8000
```

---

# Interactive API Docs

Swagger UI (this is recommended for testing):

```
http://127.0.0.1:8000/docs
```

This page allows you to:

- View all available endpoints
- Try requests directly in the browser
- Inspect response JSON

---

# API Endpoints

All routes are defined in:

```
backend/app/api/routes.py
```

---

## List Available Models

```
GET /models
```

Returns:

```json
{
  "models": ["CelebA"]
}
```

Models are detected automatically from `activation_cache/`.

---

## List Cluster Sets for a Model

```
GET /models/{model_name}/sets
```

Example:

```
GET /models/CelebA/sets
```

Returns:

```json
{
  "model": "CelebA",
  "sets": ["set_01"]
}
```

This endpoint lists the available cluster-path sets for a selected model.  
Each set represents one version of clustering results generated for that model.

---

## Get Model Metadata

```
GET /models/{model_name}/metadata
```

Returns:

```json
{
  "model": "CelebA",
  "metadata": {
    "num_examples": 162770,
    "layers": ["conv1", "conv2", "conv3", "fc1", "fc2"],
    "k": 5
  }
}
```

Frontend uses:

- `layers` -> layout visualization columns
- `k` -> number of clusters per layer
- `num_examples` -> dataset size

---

## Get Centroids

```
GET /models/{model_name}/sets/{set_name}/centroids
```

Returns per-layer centroids:

```json
{
  "model": "CelebA",
  "set": "set_01",
  "centroids": {
    "conv1": [...],
    "conv2": [...]
  }
}
```

This endpoint returns the cluster centroids for each layer in a selected model and set.  
The frontend uses these centroids to visualize and represent the clusters in the dashboard.

---

## Get Single Example Path (Recommended)

```
GET /models/{model_name}/sets/{set_name}/paths/{example_id}
```

Example:

```
GET /models/CelebA/sets/set_01/paths/example_0001
```

Returns:

```json
{
  "model": "CelebA",
  "set": "set_01",
  "example_id": "example_0001",
  "path": [1, 0, 2, 4, 3]
}
```

This endpoint is lightweight and recommended for interactive use.

---

## Preview Paths (Paginated)

```
GET /models/{model_name}/sets/{set_name}/paths?limit=10&offset=0
```

Returns a sliced preview:

```json
{
  "model": "CelebA",
  "set": "set_01",
  "total": 162770,
  "limit": 10,
  "offset": 0,
  "paths": {
    "example_0000": [ ... ],
    "example_0001": [ ... ]
  }
}
```

Notes:

- Full `paths.json` can be large.
- Use pagination or single-example lookup when possible.

This endpoint returns a small paginated slice of cluster paths instead of the full dataset.  
It helps the frontend load large path data efficiently without fetching the entire file at once.

---

## How the Frontend Calls the API

The backend runs locally at:

```
http://127.0.0.1:8000
```

All endpoints are standard HTTP `GET` requests that return JSON.

Example in React:

```javascript
const BASE_URL = "http://127.0.0.1:8000";

const response = await fetch(`${BASE_URL}/models`);
const data = await response.json();
```

The frontend should call the endpoints in this order:

1. `/models` -> get available models
2. `/models/{model}/sets` -> get cluster sets
3. `/models/{model}/metadata` → get model structure info
4. `/models/{model}/sets/{set}/centroids` -> get cluster centers
5. `/models/{model}/sets/{set}/paths/{example_id}` -> get a specific example path
